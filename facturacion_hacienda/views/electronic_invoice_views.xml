<?xml version="1.0" encoding="utf-8"?>
<odoo>
	<data>

		<record id="invoice_tree_inherit" model="ir.ui.view">
			<field name="name">account.invoice.tree.inherit</field>
			<field name="model">account.invoice</field>
			<field name="inherit_id" ref="account.invoice_tree"/>
			<field name="arch" type="xml">
				<field name="state" position="before">
					<field name="status_hacienda"/>
				</field>
			</field>
		</record>


		<record id="invoice_form_inherit" model="ir.ui.view">
			<field name="name">account.invoice.form.inherit bryan</field>
			<field name="model">account.invoice</field>
			<field name="inherit_id" ref="account.invoice_form"/>
			<field name="arch" type="xml">
				<xpath expr="//button[@name='action_invoice_sent']" position="before">
					<button name="action_invoice_sent" type="object" string="Enviar por correo" attrs="{'invisible':[('state', 'in', ('open', 'paid', 'cancel', 'draft'))]}" groups="base.group_user"/>
				</xpath>

				<field name="type" position="before">
					<h2>
						<field name="clave_envio_hacienda" readonly="1"  attrs="{'invisible': [('clave_envio_hacienda', '=', False)]}" nolabel="1"/>
					</h2>
				</field>

                <field name="fiscal_position_id" position="replace">
                </field>

                <field name="payment_term_id" position="attributes">
                    <attribute name="required">True</attribute>
                </field>

				<field name="payment_term_id" position="after">
					<field name="payment_methods_id" required="1" attrs="{'readonly':[('state','!=','draft')]}" options="{'no_create': 1, 'no_create_edit': 1}"/>

					<field name="actividad_id" required="1"/>

					<field name="fiscal_position_id" />
					<field name="situacion" groups="facturacion_hacienda.campos_facturacion_electronica" attrs="{ 'readonly': [('state', '!=', 'draft')]}"/>
					<field name="tipo_documento_pf" attrs="{'invisible': [('fiscal_position_id', '=', False)], 'required': [('fiscal_position_id', '!=', False)]}"/>
					<field name="numero_documento_pf" attrs="{'invisible': [('fiscal_position_id', '=', False)], 'required': [('fiscal_position_id', '!=', False)]}"/>
					<field name="nombre_institucion_pf"  attrs="{'invisible': [('fiscal_position_id', '=', False)], 'required': [('fiscal_position_id', '!=', False)]}"/>
					<field name="fecha_emision_pf"  attrs="{ 'invisible': [('fiscal_position_id', '=', False)], 'required': [('fiscal_position_id', '!=', False)]}"/>

				</field>
				<field name="date_invoice" position="attributes">
					<attribute name="readonly">1</attribute>
				</field>


                <xpath expr="//notebook" position="inside">
                    <page string="Facturación Electronica" attrs="{'invisible': [('status_hacienda', '=', False)]}" name="hacienda" >
						<group>
							<group>
								<field name="fname_xml_respuesta_tributacion" invisible="1" readonly="1"/>
								<field name="xml_respuesta_tributacion" filename="fname_xml_respuesta_tributacion" readonly="1"/>
							</group>
							<group>
								<field name="fname_xml_comprobante" invisible="1" readonly="1"/>
								<field name="xml_comprobante" filename="fname_xml_comprobante" readonly="1"/>
							</group>
						</group>

                        <button name="consulta_estado_hacienda" type="object" string="Consultar Estado" attrs="{ 'invisible': [('status_hacienda', 'not in', ('procesando', 'recibido'))]}"/>
                        <group>
                            <field name="mostrar_boton" invisible ="1"/>
                            <field name="status_hacienda" readonly="1"/>
                        </group>

                        <field name="xml_file_hacienda_firmado" widget="ace_xml" options="{'mode': 'xml'}" />


                    </page>

                </xpath>

				<xpath expr="//field[@name='invoice_line_ids']//tree//field[@name='discount']" position="after">
					<field name="discount_note" required="0"/>
				</xpath>

				<xpath expr="//field[@name='invoice_line_ids']//tree//field[@name='uom_id']" position="attributes">
					<attribute name="groups"></attribute>
				</xpath>

				<xpath expr="//field[@name='invoice_line_ids']//tree//field[@name='discount']" position="attributes">
					<attribute name="groups"></attribute>
				</xpath>

				<xpath expr="//field[@name='invoice_line_ids']//tree//field[@name='product_id']" position="attributes">
					<attribute name="required">1</attribute>
				</xpath>

				<button name="action_invoice_draft" position="attributes">
					<attribute name="invisible">1</attribute>
				</button>

				<xpath expr="//button[@type='action'][2]" position="attributes">
					<attribute name="attrs">{'invisible': [('state', 'not in', ('open','proforma2','paid'))]}</attribute>
				</xpath>

			</field>
		</record>



		<record id="account_cancel_invoice_form_inherit" model="ir.ui.view">
			<field name="name">account.invoice.form.inherit</field>
			<field name="model">account.invoice</field>
			<field name="inherit_id" ref="account_cancel.invoice_form_cancel_inherit"/>
			<field name="arch" type="xml">


				<button name="action_invoice_cancel" position="attributes">
					<attribute name="attrs">{'invisible':[('status_hacienda','!=', 'rechazado')]}</attribute>
					<attribute name="states">cancel</attribute>
				</button>


			</field>
		</record>

		<record id="invoice_supplier_form_inherit" model="ir.ui.view">
			<field name="name">account.invoice.supplier.form.inherit</field>
			<field name="model">account.invoice</field>
			<field name="inherit_id" ref="account.invoice_supplier_form"/>
			<field name="arch" type="xml">

				<xpath expr="//field[@name='type']" position="before">
					<field name="fname_xml_supplier_approval" invisible="1" />
					<field name="xml_supplier_approval" filename="fname_xml_supplier_approval"  attrs="{'readonly':[('state','!=', 'draft')]}"/>
				</xpath>

				<xpath expr="//field[@name='partner_id']" position="before">
					<field name="state_invoice_partner" attrs="{'required': [('xml_supplier_approval', '!=', False)], 'invisible':[('xml_supplier_approval', '=', False)], 'readonly':[('state','!=', 'draft')]}"/>
                                        <field name="regimen_simplificado"/>
				</xpath>


				<xpath expr="//notebook" position="inside">
					<page string="Facturación Electrónica" name="hacienda">
						<group>
							<group>
								<field name="fname_xml_respuesta_tributacion" invisible="1" readonly="1"/>
								<field name="xml_respuesta_tributacion" filename="fname_xml_respuesta_tributacion" readonly="1"/>

								<!--button name="charge_xml_data" type="object" string="Cargar datos desde XML" colspan="2" attrs="{'invisible':[('state','!=','draft')]}"/-->
								<!--button name="send_xml" type="object" string="Enviar XML" colspan="2" attrs="{'invisible':[('xml_comprobante','!=',False)]}"/-->

								<field name="status_hacienda" readonly="1" attrs="{'invisible': [('fname_xml_comprobante', '=', False)]}"/>
								<button name="consulta_estado_hacienda" type="object" string="Consultar Estado" attrs="{'invisible': [('fname_xml_comprobante', '=', False)]}"/>


							</group>
							<group>
								<field name="fname_xml_comprobante" invisible="1" readonly="1"/>
								<field name="xml_comprobante" filename="fname_xml_comprobante" readonly="1"/>

								<!--field name="date_issuance" readonly="1"/>
								<field name="number_electronic" readonly="1"/>
								<field name="state_send_invoice" readonly="1"/>
								<field name="fname_xml_respuesta_tributacion" invisible="1" readonly="1"/>
								<field name="xml_respuesta_tributacion" filename="fname_xml_respuesta_tributacion" readonly="1"/-->
							</group>
						</group>

						<field name="xml_file_hacienda_firmado" widget="ace_xml" options="{'mode': 'xml'}" />
					</page>
				</xpath>
				<xpath expr="//field[@name='amount_total']" position="after">
					<field name="amount_tax_electronic_invoice"/>
					<field name="amount_total_electronic_invoice"/>
				</xpath>
			</field>
		</record>



		<record id="view_account_invoice_refund_inherit" model="ir.ui.view">
			<field name="name">account.invoice.refund.form.inherit</field>
			<field name="model">account.invoice.refund</field>
			<field name="inherit_id" ref="account.view_account_invoice_refund"/>
			<field name="arch" type="xml">
				<field name="filter_refund" position="after">
					<field name="invoice_id" readonly="1"/>
					<field name="payment_term_id" required="1"/>
					<field name="nd" invisible="1"/>
					<field name="reference_code_id" options="{'no_create_edit': 1}" attrs="{'invisible': [('nd', '=', True)]}" required="1"/>
				</field>
			</field>
		</record>

	</data>
</odoo>
